# 实验报告

## 实验环境

- Virtualbox

- Ubuntu 20.04 Server 64bit

- Git bash

- Windows10 cmd

----

## 实验要求

1. 阅读并完成Systemd 入门教程的命令篇与实战篇，录屏上传到asciinema

2. 完成课后自查清单

---

## 实验过程

### 一、命令篇

#### 系统管理

- 3.1——3.6
[![3.1——3.6](https://asciinema.org/a/6DEOpJ2z1VpQHLpMUbnuI3dMY.svg)](https://asciinema.org/a/6DEOpJ2z1VpQHLpMUbnuI3dMY)

#### Unit

- 4.1——4.2
[![4.1——4.2](https://asciinema.org/a/96ozS7Co4e1ugUmoAWZFUBI9O.svg)](https://asciinema.org/a/96ozS7Co4e1ugUmoAWZFUBI9O)

- 4.3——4.4
[![4.3——4.4](https://asciinema.org/a/Xe3ah63J1vWiBvmQ9cls3rRCh.svg)](https://asciinema.org/a/Xe3ah63J1vWiBvmQ9cls3rRCh)

##### Unit的配置文件

- 5.1——5.4
[![5.1——5.4](https://asciinema.org/a/4StNYBOA8cpfUqPjhrteKB48t.svg)](https://asciinema.org/a/4StNYBOA8cpfUqPjhrteKB48t)

##### Target

- 6
[![6 Target](https://asciinema.org/a/4vZAMEz7SndX6lVfDS127LKJc.svg)](https://asciinema.org/a/4vZAMEz7SndX6lVfDS127LKJc)

#### 日志管理

- 7
[![7 日志管理](https://asciinema.org/a/wmYPUh9HvkDrU0Oxn9Qa0Rtfy.svg)](https://asciinema.org/a/wmYPUh9HvkDrU0Oxn9Qa0Rtfy)

---

#### 二、实战篇

[![实战篇](https://asciinema.org/a/Bo0t2RWSvkNYtb9NBWGo1CQ1D.svg)](https://asciinema.org/a/Bo0t2RWSvkNYtb9NBWGo1CQ1D)

---

## 实验中遇到的问题

#### 问题一：出现命令找不到

```shell
sudo: /etc/init.d/apache2: command not found
```

**解决方法：**

之前没有下载apache2，所以下载apache2就好了

```shell
sudo apt-get update

sudo apt-get install apache2
```

##### 问题二：没有关闭计算机的自动校验时间功能

报错：
```bash
Failed to set time: Automatic time synchronization is enabled
```

**解决方法：**

```bash
timedatectl set-ntp no
```

#### 问题三：重新加载服务的配置文件时报错

报错信息：
```bash
apache2.service is not active, cannot reload
```

**解决方法：**

```bash
启动apache2.service：
sudo systemctl start apache2.service
```

---

## 自查清单

- 如何添加一个用户并使其具备sudo执行程序的权限？

     添加用户：
    ```shell
    sudo adduser user_name
    ```

    添加sudo执行程序的权限：
    ```shell
    username ALL=(ALL) ALL
    ```


- 如何将一个用户添加到一个用户组？

    ```shell
    sudo usermod -a [username] -G [teamname]
    ```

- 如何查看当前系统的分区表和文件系统详细信息？

    查看分区表：
    ```shell
    sudo fdisk -l
    ```

    查看磁盘占用空间：
    ```shell
    df -h
    ```

    查看挂载文件系统类型：
    ```shell
    df -T
    ``` 

- 如何实现开机自动挂载Virtualbox的共享目录分区？

    ```shell
    创建文件夹：
    sudo mkdir /mnt/[dir_name]

    自动挂载：
    sudo mount -t vboxsf [共享文件夹名] /mnt/[dir_name]
    ```

- 基于LVM（逻辑分卷管理）的分区如何实现动态扩容和缩减容量？

    动态缩减：
    ```shell
    lvresize --size -{{SIZE}} --resizefs {{volume_group}}/{{logical_volume}}
    ```

    动态扩容：
    ```shell
    lvresize --size +{{SIZE}} --resizefs {{volume_group}}/{{logical_volume}}
    ```

- 如何通过systemd设置实现在网络连通时运行一个指定脚本，在网络断开时运行另一个脚本？

    修改```systemd-networkd.service```配置文件

    ```bash
    ExecStartPost = [网络连通时运行的指定脚本的路径] 
    
    ExecStopPost = [网络断开时运行的指定脚本的路径]
    ```

- 如何通过systemd设置实现一个脚本在任何情况下被杀死之后会立即重新启动？实现杀不死？

    [Service]中修改：
    ```bash
    Restart=always
    ```
